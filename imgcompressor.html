<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Compressor</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    text-align: center;
    padding: 40px;
  }
  h1 {
    color: #333;
  }
  #server-status {
    font-weight: bold;
    margin-bottom: 20px;
  }
  #upload-form {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    display: inline-block;
  }
  input[type="file"] {
    margin: 10px;
  }
  button {
    background: #007BFF;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover {
    background: #0056b3;
  }
  #result {
    margin-top: 20px;
  }
</style>
</head>
<body>

<h1>üì¶ Image Compressor</h1>
<div id="server-status">Checking server status...</div>

<form id="upload-form">
  <input type="file" id="image-input" name="image" accept="image/*" required>
  <br>
  <button type="submit">Compress Image</button>
</form>

<div id="result"></div>

<script>
  // üñ•Ô∏è Replace this with your Ngrok public URL
  const serverURL = "https://abc123.ngrok.io";

  // Check if server is online
  async function checkServer() {
    const statusDiv = document.getElementById("server-status");
    try {
      const res = await fetch(`${serverURL}/status`);
      if (res.ok) {
        const data = await res.json();
        if (data.status === "online") {
          statusDiv.textContent = "üü¢ Server Online";
          statusDiv.style.color = "green";
        } else {
          statusDiv.textContent = "üü† Unexpected Server Response";
          statusDiv.style.color = "orange";
        }
      } else throw new Error("Server not OK");
    } catch (err) {
      statusDiv.textContent = "üî¥ Server Offline";
      statusDiv.style.color = "red";
    }
  }

  checkServer();
  setInterval(checkServer, 10000); // check every 10 seconds

  // Handle image upload
  const form = document.getElementById("upload-form");
  const resultDiv = document.getElementById("result");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const fileInput = document.getElementById("image-input");
    const file = fileInput.files[0];
    if (!file) return alert("Please select an image first!");

    resultDiv.innerHTML = "‚è≥ Compressing... Please wait.";

    const formData = new FormData();
    formData.append("image", file);

    try {
      const response = await fetch(`${serverURL}/compress`, {
        method: "POST",
        body: formData,
      });

      if (!response.ok) throw new Error("Compression failed");

      // Convert response to downloadable file
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "compressed.jpg";
      a.textContent = "‚¨áÔ∏è Download Compressed Image";
      resultDiv.innerHTML = "";
      resultDiv.appendChild(a);
    } catch (err) {
      resultDiv.innerHTML = "‚ùå Error: " + err.message;
    }
  });
</script>

</body>
</html>
